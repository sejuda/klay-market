{"ast":null,"code":"/*\n    Copyright 2019 The caver-js Authors\n    This file is part of the caver-js library.\n\n    The caver-js library is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    The caver-js library is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with the caver-js. If not, see <http://www.gnu.org/licenses/>.\n*/\nconst isValidRole = require('../../../../caver-utils').isValidRole;\n\nconst isValidPublicKey = require('../../../../caver-utils').isValidPublicKey;\n\nclass AccountForUpdate {\n  constructor(address, keyForUpdate, options) {\n    this.address = address;\n    this.keyForUpdate = keyFormatter(keyForUpdate, options);\n  }\n\n  fillUpdateObject(updateObject) {\n    delete updateObject.key;\n    Object.assign(updateObject, this.keyForUpdate);\n  }\n\n}\n\nfunction keyFormatter(keyForUpdate, options) {\n  const keyObject = {};\n\n  if (typeof keyForUpdate === 'string') {\n    if (options) throw new Error('Failed to keyFormatter for AccountForUpdate: AccountKeyPublic/legacyKey/failKey cannot have options');\n\n    switch (keyForUpdate) {\n      case 'legacyKey':\n        keyObject.legacyKey = true;\n        break;\n\n      case 'failKey':\n        keyObject.failKey = true;\n        break;\n\n      default:\n        if (!isValidPublicKey(keyForUpdate)) throw new Error('Invalid public key');\n        keyObject.publicKey = keyForUpdate;\n        break;\n    }\n  } else if (Array.isArray(keyForUpdate)) {\n    if (!options || !options.threshold || !options.weight) throw new Error('For AccountKeyMultiSig, threshold and weight should be defined in options object.');\n    if (!Array.isArray(options.weight)) throw new Error('The weight should be defined as a array.');\n    if (options.weight.length !== keyForUpdate.length) throw new Error('The length of keys in AccountKeyMultiSig and the length of weight array do not match.');\n    keyObject.multisig = {\n      threshold: options.threshold,\n      keys: []\n    };\n    let weightSum = 0;\n\n    for (let i = 0; i < keyForUpdate.length; i++) {\n      const key = keyForUpdate[i];\n      if (!isValidPublicKey(key)) throw new Error('Invalid public key');\n      keyObject.multisig.keys.push({\n        weight: options.weight[i],\n        publicKey: key\n      });\n      weightSum += options.weight[i];\n    }\n\n    if (weightSum < options.threshold) throw new Error('Invalid options for AccountKeyMultiSig: The sum of weights is less than the threshold.');\n  } else {\n    for (const key in keyForUpdate) {\n      if (!isValidRole(key)) throw new Error(`Invalid role is defined: ${key}`);\n      options = options || {};\n\n      if (key === 'transactionKey') {\n        keyObject.roleTransactionKey = keyFormatter(keyForUpdate[key], options.transactionKey);\n      }\n\n      if (key === 'updateKey') {\n        keyObject.roleAccountUpdateKey = keyFormatter(keyForUpdate[key], options.updateKey);\n      }\n\n      if (key === 'feePayerKey') {\n        keyObject.roleFeePayerKey = keyFormatter(keyForUpdate[key], options.feePayerKey);\n      }\n    }\n  }\n\n  return keyObject;\n}\n\nmodule.exports = AccountForUpdate;","map":{"version":3,"sources":["/Users/mac/Desktop/klay-market/node_modules/caver-js/packages/caver-klay/caver-klay-accounts/src/account/accountForUpdate.js"],"names":["isValidRole","require","isValidPublicKey","AccountForUpdate","constructor","address","keyForUpdate","options","keyFormatter","fillUpdateObject","updateObject","key","Object","assign","keyObject","Error","legacyKey","failKey","publicKey","Array","isArray","threshold","weight","length","multisig","keys","weightSum","i","push","roleTransactionKey","transactionKey","roleAccountUpdateKey","updateKey","roleFeePayerKey","feePayerKey","module","exports"],"mappings":"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","sourcesContent":["/*\n    Copyright 2019 The caver-js Authors\n    This file is part of the caver-js library.\n\n    The caver-js library is free software: you can redistribute it and/or modify\n    it under the terms of the GNU Lesser General Public License as published by\n    the Free Software Foundation, either version 3 of the License, or\n    (at your option) any later version.\n\n    The caver-js library is distributed in the hope that it will be useful,\n    but WITHOUT ANY WARRANTY; without even the implied warranty of\n    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n    GNU Lesser General Public License for more details.\n\n    You should have received a copy of the GNU Lesser General Public License\n    along with the caver-js. If not, see <http://www.gnu.org/licenses/>.\n*/\n\nconst isValidRole = require('../../../../caver-utils').isValidRole\nconst isValidPublicKey = require('../../../../caver-utils').isValidPublicKey\n\nclass AccountForUpdate {\n    constructor(address, keyForUpdate, options) {\n        this.address = address\n        this.keyForUpdate = keyFormatter(keyForUpdate, options)\n    }\n\n    fillUpdateObject(updateObject) {\n        delete updateObject.key\n        Object.assign(updateObject, this.keyForUpdate)\n    }\n}\n\nfunction keyFormatter(keyForUpdate, options) {\n    const keyObject = {}\n\n    if (typeof keyForUpdate === 'string') {\n        if (options) throw new Error('Failed to keyFormatter for AccountForUpdate: AccountKeyPublic/legacyKey/failKey cannot have options')\n        switch (keyForUpdate) {\n            case 'legacyKey':\n                keyObject.legacyKey = true\n                break\n            case 'failKey':\n                keyObject.failKey = true\n                break\n            default:\n                if (!isValidPublicKey(keyForUpdate)) throw new Error('Invalid public key')\n                keyObject.publicKey = keyForUpdate\n                break\n        }\n    } else if (Array.isArray(keyForUpdate)) {\n        if (!options || !options.threshold || !options.weight)\n            throw new Error('For AccountKeyMultiSig, threshold and weight should be defined in options object.')\n        if (!Array.isArray(options.weight)) throw new Error('The weight should be defined as a array.')\n        if (options.weight.length !== keyForUpdate.length)\n            throw new Error('The length of keys in AccountKeyMultiSig and the length of weight array do not match.')\n\n        keyObject.multisig = {\n            threshold: options.threshold,\n            keys: [],\n        }\n\n        let weightSum = 0\n\n        for (let i = 0; i < keyForUpdate.length; i++) {\n            const key = keyForUpdate[i]\n            if (!isValidPublicKey(key)) throw new Error('Invalid public key')\n            keyObject.multisig.keys.push({\n                weight: options.weight[i],\n                publicKey: key,\n            })\n            weightSum += options.weight[i]\n        }\n\n        if (weightSum < options.threshold)\n            throw new Error('Invalid options for AccountKeyMultiSig: The sum of weights is less than the threshold.')\n    } else {\n        for (const key in keyForUpdate) {\n            if (!isValidRole(key)) throw new Error(`Invalid role is defined: ${key}`)\n            options = options || {}\n            if (key === 'transactionKey') {\n                keyObject.roleTransactionKey = keyFormatter(keyForUpdate[key], options.transactionKey)\n            }\n            if (key === 'updateKey') {\n                keyObject.roleAccountUpdateKey = keyFormatter(keyForUpdate[key], options.updateKey)\n            }\n            if (key === 'feePayerKey') {\n                keyObject.roleFeePayerKey = keyFormatter(keyForUpdate[key], options.feePayerKey)\n            }\n        }\n    }\n\n    return keyObject\n}\n\nmodule.exports = AccountForUpdate\n"]},"metadata":{},"sourceType":"script"}